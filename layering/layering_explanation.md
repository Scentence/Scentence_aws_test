# 향수 레이어링 마법사: 재미있는 컴퓨터 프로그램 가이드

## 이 프로그램은 뭐야?
너가 향수로 놀고 있고, 좋아하는 냄새가 하나 있다고 생각해봐 (예를 들어, 레몬처럼 상큼한 냄새). 이 프로그램은 똑똑한 마법사 친구처럼 도와줘! 네 향수 위에 다른 향수를 더해서 더 좋게 만들어줘—like 색을 섞어서 새 그림을 만드는 거야! 이건 사진이나 버튼을 보여주지 않아; 뒤에서 냄새를 생각해서 간단한 목록으로 아이디어를 줘.

이 프로그램은 "layering"이라는 폴더에 살고, Python (재미있는 컴퓨터 언어)을 써. 향수에 관한 큰 프로젝트의 일부야, 그리고 컴퓨터에서 조용한 도우미처럼 돌아가 ( "backend"라고 불러).

## 어떻게 작동해? (게임처럼 단계별로)
1. **준비하기**: 프로그램은 `perfumes.json`이라는 파일에서 향수 큰 목록을 불러와. 각 향수에는 이름, 브랜드, 냄새 점수 카드 (예: "달콤한"이나 "나무 같은")가 있어. 이걸 마법 숫자로 바꿔서 컴퓨터가 놀 수 있게 해.
   
   *ASCII 도표 (데이터가 어떻게 불러와지는지):*
   ```
   [Perfumes.json 파일]
          |
          v
   [데이터베이스 상자] --> [숫자 (벡터)로 바뀜]
   ```
   **도표 설명**: 파일은 향수 정보 가득한 장난감 상자 같아. 데이터베이스 상자가 열어서 단어를 숫자로 바꿔 (벡터), "달콤한"을 "7"로 바꾸는 거처럼 수학 게임에 써. 프로그램이 시작할 때 이렇게 해서 도울 준비가 돼!

2. **질문 듣기**: 누군가 (예: 웹사이트)가 메시지를 보내: "내 기본 향수는 이거야, 더 따뜻하게 하고 싶어!" 프로그램은 이 입력을 받고 생각하기 시작해. 기본 향수가 있는지 확인해—if 없으면 "이런, 찾을 수 없어!"라고 해.

3. **마법 수학 하기**: 네 기본 향수의 숫자를 보고 다른 걸 확인해. "물 냄새와 사탕 냄새 섞지 마!" 같은 규칙을 따라. 얼마나 잘 맞는지 점수를 매기고 최고를 골라. 좋은 게 충분하지 않으면 메모해.

   *ASCII 도표 (마법 수학):*
   ```
   [기본 향수] --> [규칙 확인] --> [점수 매기기] --> [상위 3개 고르기]
         |                |                  |
         v                v                  v
   [화합?]       [충돌 없음?]      [높은 점수?]
   ```
   **도표 설명**: 네 기본 향수는 주 장난감 같아. 프로그램이 규칙을 확인해 ( "싸우는 냄새 없음"), 얼마나 친한지 점수를 매겨 (화합), 최고 친구를 골라. 나쁜 섞임을 건너뛰거나 3개 미만이면 메모해.

4. **답 주기**: 제안 목록을 점수와 메모랑 같이 보내. 예: "기본 먼저 뿌리고, 그 다음에 위에 뿌려!" 잘못되면 도움 메시지를 줘.

5. **연습 시간**: `tests/` 폴더에 작은 테스트가 있어 마법사가 똑똑한지 확인해, 올바른 향수를 고르는지 에러 처리하는지처럼.

## 모든 부분들 (함수와 변수들)
- **주요 부분들 (main.py에)**: 
  - `app`: 메시지를 듣는 큰 보스.
  - `repository`: 향수 데이터 저장 상자.
  - `layering_recommend()`: 마법사의 주요 일—네 요청 받고 답 줘.
  
- **수학 도우미들 (tools.py에)**:
  - `get_target_vector()`: 네 단어로 "소원 목록" 만듦 (예: "따뜻한"이 숫자 높임).
  - `calculate_advanced_layering()`: 향수 비교하고 점수 매기는 뇌.
  - `rank_recommendations()`: 최고 골라서 정렬.

- **데이터 부분들 (database.py에)**:
  - `PerfumeRepository`: 향수 불러와 숫자로 바꿈.
  - `get_perfume()`: ID로 특정 향수 찾음.

- **규칙과 목록들 (constants.py에)**:
  - `ACCORDS`: 아이스크림 맛처럼 냄새 종류 21개 목록.
  - `CLASH_PAIRS`: 나쁜 섞임 규칙, "생선과 사탕 섞지 마!".
  - `KEYWORD_MAP`: "시원한" 같은 단어를 냄새 높임으로 바꿈.

- **데이터 모양들 (schemas.py에)**:
  - `LayeringRequest`: 네가 보내는 거 (기본 ID + 단어들).
  - `LayeringResponse`: 보내는 답 (제안들).

- **다른 도우미들**:
  - `graph.py`와 `prompts.py`: 미래 재미있는 거, AI 이야기처럼.
  - 변수들: `vector` (숫자 목록), `total_score` (최종 점수).

*ASCII 도표 (부분들이 어떻게 연결되는지):*
```
[사용자 입력] --> [main.py (app)] --> [tools.py (수학)] --> [database.py (데이터)]
       |             |                       |                      |
       v             v                       v                      v
 [답변]   [듣기]             [계산]          [향수 불러오기]
```
**도표 설명**: 모두 팀처럼 같이 일해. 네 질문이 주 앱으로 가서 수학 도구로 데이터 상자 쓰고, 답 보내. 데이터 상자가 못 찾으면 앱에 "찾을 수 없음!"이라고 말해.

## 코드가 어디서 돌아가?
- **백엔드 컴퓨터**: FastAPI로 웹 서버 (조용한 우체국처럼). Python 있는 컴퓨터에서 돌아. 더 큰 앱 (웹사이트처럼)에 도우미로 연결돼.
- **어떻게 시작해?**: `python main.py` 같은 명령 쳐서 또는 Docker (모두 담는 마법 상자) 써. Dockerfile은 안전하게 만드는 레시피 같아.
- **Requirements.txt**: 필요한 도구 쇼핑 목록 (FastAPI처럼).

## 어떤 입력 받고 어떤 출력 줘?
- **입력**: 기본 향수 ID와 단어들 있는 메시지 (예: ["따뜻한"]). ID 틀리면 에러 생길 수 있어.
- **출력**: 최고 제안 JSON 목록 (사진 없음, 그냥 텍스트). 뿌리기 순서와 점수 포함.

## 어떻게 실행해?
- **설정**: Python 가져와 `requirements.txt`에서 설치.
- **실행**: 명령 또는 Docker.
- **테스트**: `pytest`로 확인 (게임 연습처럼).

## 재미있는 추가 사실들
- `perfumes.json`에 새 향수 추가해서 마법사 더 똑똑하게 해!
- 나중에 AI로 더 멋진 거 할 수 있어.